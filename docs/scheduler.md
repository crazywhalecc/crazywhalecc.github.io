# 计时器

框架内建计时器是基于Swoole的异步计时器来的，运行机制是纯异步，在worker进程中运行。

框架默认开启了计时器，且间隔为`1s`，而因为部分功能可能更依赖1秒为间隔，所以推荐保持默认。

## 延迟发送API

在提供计时器功能的同时，也提供了延迟发送消息的功能。

CQAPI中所有支持的API里均可以加上`_after`后缀来实现延迟执行。当添加后缀后，传入参数发生了一些变化。

```php
//$ms为延迟的ms数作为传入的第一个参数，后方的参数和普通调用API相同。
CQAPI::send_private_msg_after($ms, $robot_id, $params, $callback);
```

> 延迟的秒数不得超过86400000ms（24小时），详见[Swoole计时器](https://wiki.swoole.com/wiki/page/319.html)。

## 模块中定时执行

因为默认计时器间隔为1s，所以在模块中使用的`onTick`函数传入的`$tick`变量为从计时器启动开始第几个`tick`。

比如`$tick % 900`，判断取模可以来定时执行功能。比如这个例子就是900秒。